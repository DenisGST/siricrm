{# Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚: msg #}
{% if msg.direction == "incoming" %}
  <div class="chat chat-start">
{% else %}
  <div class="chat chat-end">
{% endif %}
  <div class="chat-bubble
              {% if msg.direction == 'incoming' %}
                bg-emerald-50 text-emerald-900
              {% else %}
                chat-bubble-primary
              {% endif %}">
    {% if msg.message_type == "text" and not msg.file %}
      {{ msg.content|linebreaksbr }}
    {% elif msg.message_type == "image" and msg.file %}
      <a href="{% url 'file_download' msg.file.id %}" target="_blank" class="block">
        <img src="{% url 'file_download' msg.file.id %}"
             alt="{{ msg.file.filename }}"
             class="max-w-xs rounded-lg">
      </a>
      {% if msg.content %}
        <div class="mt-1 text-xs opacity-80">{{ msg.content|linebreaksbr }}</div>
      {% endif %}
    {% elif msg.message_type == "document" and msg.file %}
      <a href="{% url 'file_download' msg.file.id %}" target="_blank"
         class="flex items-center gap-2">
        ðŸ“Ž <span class="underline text-xs break-all">
          {{ msg.file.filename|default:"Ð¤Ð°Ð¹Ð»" }}
        </span>
      </a>
      {% if msg.content %}
        <div class="mt-1 text-xs opacity-80">{{ msg.content|linebreaksbr }}</div>
      {% endif %}
    {% else %}
      {{ msg.content|linebreaksbr }}
    {% endif %}
  </div>

  <div class="chat-footer text-[10px] text-base-content/60">
    {{ msg.created_at|date:"d.m H:i" }}
  </div>
</div>